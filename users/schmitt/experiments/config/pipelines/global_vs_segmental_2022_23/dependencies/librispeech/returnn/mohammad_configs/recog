#!rnn.py


def summary(name, x):
    """
    :param str name:
    :param tf.Tensor x: (batch,time,feature)
    """
    from returnn.tf.compat import v1 as tf

    # tf.summary.image wants [batch_size, height,  width, channels],
    # we have (batch, time, feature).
    img = tf.expand_dims(x, axis=3)  # (batch,time,feature,1)
    img = tf.transpose(img, [0, 2, 1, 3])  # (batch,feature,time,1)
    tf.summary.image(name, img, max_outputs=10)
    tf.summary.scalar("%s_max_abs" % name, tf.reduce_max(tf.abs(x)))
    mean = tf.reduce_mean(x)
    tf.summary.scalar("%s_mean" % name, mean)
    stddev = tf.sqrt(tf.reduce_mean(tf.square(x - mean)))
    tf.summary.scalar("%s_stddev" % name, stddev)
    tf.summary.histogram("%s_hist" % name, tf.reduce_max(tf.abs(x), axis=2))


def _mask(x, batch_axis, axis, pos, max_amount):
    """
    :param tf.Tensor x: (batch,time,feature)
    :param int batch_axis:
    :param int axis:
    :param tf.Tensor pos: (batch,)
    :param int|tf.Tensor max_amount: inclusive
    """
    from returnn.tf.compat import v1 as tf

    ndim = x.get_shape().ndims
    n_batch = tf.shape(x)[batch_axis]
    dim = tf.shape(x)[axis]
    amount = tf.random_uniform(
        shape=(n_batch,), minval=1, maxval=max_amount + 1, dtype=tf.int32
    )
    pos2 = tf.minimum(pos + amount, dim)
    idxs = tf.expand_dims(tf.range(0, dim), 0)  # (1,dim)
    pos_bc = tf.expand_dims(pos, 1)  # (batch,1)
    pos2_bc = tf.expand_dims(pos2, 1)  # (batch,1)
    cond = tf.logical_and(
        tf.greater_equal(idxs, pos_bc), tf.less(idxs, pos2_bc)
    )  # (batch,dim)
    if batch_axis > axis:
        cond = tf.transpose(cond)  # (dim,batch)
    cond = tf.reshape(
        cond, [tf.shape(x)[i] if i in (batch_axis, axis) else 1 for i in range(ndim)]
    )
    from TFUtil import where_bc

    x = where_bc(cond, 0.0, x)
    return x


def random_mask(x, batch_axis, axis, min_num, max_num, max_dims):
    """
    :param tf.Tensor x: (batch,time,feature)
    :param int batch_axis:
    :param int axis:
    :param int|tf.Tensor min_num:
    :param int|tf.Tensor max_num: inclusive
    :param int|tf.Tensor max_dims: inclusive
    """
    from returnn.tf.compat import v1 as tf

    n_batch = tf.shape(x)[batch_axis]
    if isinstance(min_num, int) and isinstance(max_num, int) and min_num == max_num:
        num = min_num
    else:
        num = tf.random_uniform(
            shape=(n_batch,), minval=min_num, maxval=max_num + 1, dtype=tf.int32
        )
    # https://github.com/tensorflow/tensorflow/issues/9260
    # https://timvieira.github.io/blog/post/2014/08/01/gumbel-max-trick-and-weighted-reservoir-sampling/
    z = -tf.log(-tf.log(tf.random_uniform((n_batch, tf.shape(x)[axis]), 0, 1)))
    _, indices = tf.nn.top_k(z, num if isinstance(num, int) else tf.reduce_max(num))
    # indices should be sorted, and of shape (batch,num), entries (int32) in [0,dim)
    # indices = tf.Print(indices, ["indices", indices, tf.shape(indices)])
    if isinstance(num, int):
        for i in range(num):
            x = _mask(
                x,
                batch_axis=batch_axis,
                axis=axis,
                pos=indices[:, i],
                max_amount=max_dims,
            )
    else:
        _, x = tf.while_loop(
            cond=lambda i, _: tf.less(i, tf.reduce_max(num)),
            body=lambda i, x: (
                i + 1,
                tf.where(
                    tf.less(i, num),
                    _mask(
                        x,
                        batch_axis=batch_axis,
                        axis=axis,
                        pos=indices[:, i],
                        max_amount=max_dims,
                    ),
                    x,
                ),
            ),
            loop_vars=(0, x),
        )
    return x


def transform(data, network, time_factor=1):
    x = data.placeholder
    from returnn.tf.compat import v1 as tf

    # summary("features", x)
    step = network.global_train_step
    step1 = tf.where(tf.greater_equal(step, 1000), 1, 0)
    step2 = tf.where(tf.greater_equal(step, 2000), 1, 0)

    def get_masked():
        x_masked = x
        x_masked = random_mask(
            x_masked,
            batch_axis=data.batch_dim_axis,
            axis=data.time_dim_axis,
            min_num=step1 + step2,
            max_num=tf.maximum(tf.shape(x)[data.time_dim_axis] // 100, 2)
            * (1 + step1 + step2 * 2),
            max_dims=20 // time_factor,
        )
        x_masked = random_mask(
            x_masked,
            batch_axis=data.batch_dim_axis,
            axis=data.feature_dim_axis,
            min_num=step1 + step2,
            max_num=2 + step1 + step2 * 2,
            max_dims=data.dim // 5,
        )
        # summary("features_mask", x_masked)
        return x_masked

    x = network.cond_on_train(get_masked, lambda: x)
    return x


def speed_pert(audio, sample_rate, random_state):
    import librosa

    new_sample_rate = int(sample_rate * (1 + random_state.randint(-1, 2) * 0.1))
    if new_sample_rate != sample_rate:
        audio = librosa.core.resample(
            audio, sample_rate, new_sample_rate, res_type="kaiser_fast"
        )
    return audio


accum_grad_multiple_step = 2
adam = True
batch_size = 2400000
batching = "random"
cleanup_old_models = True
debug_mode = False
debug_print_layer_output_template = True
device = "gpu"
extern_data = {
    "audio_features": {"available_for_inference": True, "shape": (None, 1), "dim": 1},
    "bpe_labels": {
        "available_for_inference": False,
        "shape": (None,),
        "dim": 10025,
        "sparse": True,
    },
}
gradient_clip = 0.0
gradient_noise = 0.0
import_model_train_epoch1 = "/u/zeineldeen/setups/librispeech/2022-11-28--conformer-att/work/i6_core/returnn/training/AverageTFCheckpointsJob.gb8YwnG2Po2N/output/model/average"
learning_rate = 0.0008
learning_rate_control = "newbob_multi_epoch"
learning_rate_control_min_num_epochs_per_new_lr = 3
learning_rate_control_relative_error_relative_lr = True
learning_rates = [
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    0.0001,
    9.982901554404146e-05,
    9.96580310880829e-05,
    9.948704663212435e-05,
    9.931606217616581e-05,
    9.914507772020726e-05,
    9.89740932642487e-05,
    9.880310880829016e-05,
    9.863212435233161e-05,
    9.846113989637306e-05,
    9.829015544041451e-05,
    9.811917098445596e-05,
    9.794818652849742e-05,
    9.777720207253886e-05,
    9.760621761658031e-05,
    9.743523316062177e-05,
    9.726424870466322e-05,
    9.709326424870466e-05,
    9.692227979274612e-05,
    9.675129533678757e-05,
    9.658031088082901e-05,
    9.640932642487047e-05,
    9.623834196891192e-05,
    9.606735751295338e-05,
    9.589637305699482e-05,
    9.572538860103627e-05,
    9.555440414507773e-05,
    9.538341968911917e-05,
    9.521243523316062e-05,
    9.504145077720208e-05,
    9.487046632124353e-05,
    9.469948186528497e-05,
    9.452849740932643e-05,
    9.435751295336788e-05,
    9.418652849740934e-05,
    9.401554404145078e-05,
    9.384455958549223e-05,
    9.367357512953369e-05,
    9.350259067357513e-05,
    9.333160621761658e-05,
    9.316062176165804e-05,
    9.298963730569949e-05,
    9.281865284974093e-05,
    9.264766839378239e-05,
    9.247668393782384e-05,
    9.230569948186528e-05,
    9.213471502590674e-05,
    9.196373056994819e-05,
    9.179274611398965e-05,
    9.162176165803109e-05,
    9.145077720207254e-05,
    9.1279792746114e-05,
    9.110880829015544e-05,
    9.093782383419689e-05,
    9.076683937823835e-05,
    9.05958549222798e-05,
    9.042487046632124e-05,
    9.02538860103627e-05,
    9.008290155440415e-05,
    8.99119170984456e-05,
    8.974093264248705e-05,
    8.95699481865285e-05,
    8.939896373056996e-05,
    8.92279792746114e-05,
    8.905699481865285e-05,
    8.888601036269431e-05,
    8.871502590673576e-05,
    8.85440414507772e-05,
    8.837305699481866e-05,
    8.820207253886011e-05,
    8.803108808290157e-05,
    8.786010362694301e-05,
    8.768911917098446e-05,
    8.751813471502592e-05,
    8.734715025906736e-05,
    8.717616580310881e-05,
    8.700518134715027e-05,
    8.683419689119171e-05,
    8.666321243523316e-05,
    8.649222797927462e-05,
    8.632124352331607e-05,
    8.615025906735751e-05,
    8.597927461139897e-05,
    8.580829015544042e-05,
    8.563730569948188e-05,
    8.546632124352332e-05,
    8.529533678756477e-05,
    8.512435233160623e-05,
    8.495336787564767e-05,
    8.478238341968912e-05,
    8.461139896373058e-05,
    8.444041450777202e-05,
    8.426943005181347e-05,
    8.409844559585493e-05,
    8.392746113989638e-05,
    8.375647668393784e-05,
    8.358549222797928e-05,
    8.341450777202073e-05,
    8.324352331606219e-05,
    8.307253886010363e-05,
    8.290155440414508e-05,
    8.273056994818654e-05,
    8.255958549222798e-05,
    8.238860103626943e-05,
    8.221761658031089e-05,
    8.204663212435234e-05,
    8.18756476683938e-05,
    8.170466321243524e-05,
    8.153367875647669e-05,
    8.136269430051814e-05,
    8.119170984455959e-05,
    8.102072538860104e-05,
    8.08497409326425e-05,
    8.067875647668394e-05,
    8.050777202072539e-05,
    8.033678756476685e-05,
    8.016580310880829e-05,
    7.999481865284974e-05,
    7.98238341968912e-05,
    7.965284974093265e-05,
    7.94818652849741e-05,
    7.931088082901555e-05,
    7.9139896373057e-05,
    7.896891191709845e-05,
    7.87979274611399e-05,
    7.862694300518135e-05,
    7.84559585492228e-05,
    7.828497409326425e-05,
    7.81139896373057e-05,
    7.794300518134715e-05,
    7.777202072538861e-05,
    7.760103626943006e-05,
    7.74300518134715e-05,
    7.725906735751296e-05,
    7.708808290155441e-05,
    7.691709844559585e-05,
    7.674611398963731e-05,
    7.657512953367876e-05,
    7.64041450777202e-05,
    7.623316062176166e-05,
    7.606217616580311e-05,
    7.589119170984456e-05,
    7.572020725388601e-05,
    7.554922279792746e-05,
    7.537823834196892e-05,
    7.520725388601037e-05,
    7.503626943005181e-05,
    7.486528497409327e-05,
    7.469430051813472e-05,
    7.452331606217616e-05,
    7.435233160621762e-05,
    7.418134715025907e-05,
    7.401036269430051e-05,
    7.383937823834197e-05,
    7.366839378238342e-05,
    7.349740932642488e-05,
    7.332642487046633e-05,
    7.315544041450777e-05,
    7.298445595854923e-05,
    7.281347150259068e-05,
    7.264248704663212e-05,
    7.247150259067358e-05,
    7.230051813471503e-05,
    7.212953367875647e-05,
    7.195854922279793e-05,
    7.178756476683938e-05,
    7.161658031088084e-05,
    7.144559585492228e-05,
    7.127461139896373e-05,
    7.110362694300519e-05,
    7.093264248704664e-05,
    7.076165803108808e-05,
    7.059067357512954e-05,
    7.041968911917099e-05,
    7.024870466321243e-05,
    7.007772020725389e-05,
    6.990673575129534e-05,
    6.973575129533678e-05,
    6.956476683937824e-05,
    6.939378238341969e-05,
    6.922279792746113e-05,
    6.90518134715026e-05,
    6.888082901554404e-05,
    6.87098445595855e-05,
    6.853886010362695e-05,
    6.836787564766839e-05,
    6.819689119170985e-05,
    6.80259067357513e-05,
    6.785492227979274e-05,
    6.76839378238342e-05,
    6.751295336787565e-05,
    6.734196891191709e-05,
    6.717098445595856e-05,
    6.7e-05,
    6.682901554404146e-05,
    6.665803108808291e-05,
    6.648704663212435e-05,
    6.631606217616581e-05,
    6.614507772020726e-05,
    6.59740932642487e-05,
    6.580310880829016e-05,
    6.563212435233161e-05,
    6.546113989637305e-05,
    6.529015544041452e-05,
    6.511917098445596e-05,
    6.49481865284974e-05,
    6.477720207253887e-05,
    6.460621761658031e-05,
    6.443523316062177e-05,
    6.426424870466322e-05,
    6.409326424870466e-05,
    6.392227979274612e-05,
    6.375129533678757e-05,
    6.358031088082901e-05,
    6.340932642487047e-05,
    6.323834196891192e-05,
    6.306735751295336e-05,
    6.289637305699483e-05,
    6.272538860103627e-05,
    6.255440414507773e-05,
    6.238341968911918e-05,
    6.221243523316062e-05,
    6.204145077720208e-05,
    6.187046632124353e-05,
    6.169948186528497e-05,
    6.152849740932643e-05,
    6.135751295336788e-05,
    6.118652849740932e-05,
    6.101554404145078e-05,
    6.084455958549223e-05,
    6.0673575129533685e-05,
    6.050259067357513e-05,
    6.033160621761658e-05,
    6.0160621761658035e-05,
    5.998963730569948e-05,
    5.981865284974094e-05,
    5.9647668393782386e-05,
    5.947668393782384e-05,
    5.930569948186529e-05,
    5.9134715025906736e-05,
    5.896373056994819e-05,
    5.879274611398964e-05,
    5.862176165803109e-05,
    5.845077720207254e-05,
    5.8279792746113995e-05,
    5.810880829015544e-05,
    5.79378238341969e-05,
    5.7766839378238345e-05,
    5.759585492227979e-05,
    5.742487046632125e-05,
    5.7253886010362695e-05,
    5.708290155440415e-05,
    5.69119170984456e-05,
    5.674093264248705e-05,
    5.65699481865285e-05,
    5.6398963730569954e-05,
    5.62279792746114e-05,
    5.605699481865285e-05,
    5.5886010362694304e-05,
    5.571502590673575e-05,
    5.554404145077721e-05,
    5.5373056994818655e-05,
    5.520207253886011e-05,
    5.503108808290156e-05,
    5.486010362694301e-05,
    5.468911917098446e-05,
    5.451813471502591e-05,
    5.434715025906736e-05,
    5.417616580310881e-05,
    5.4005181347150264e-05,
    5.383419689119171e-05,
    5.3663212435233166e-05,
    5.3492227979274614e-05,
    5.332124352331607e-05,
    5.3150259067357516e-05,
    5.2979274611398964e-05,
    5.280829015544042e-05,
    5.2637305699481866e-05,
    5.246632124352332e-05,
    5.229533678756477e-05,
    5.212435233160622e-05,
    5.195336787564767e-05,
    5.178238341968912e-05,
    5.1611398963730573e-05,
    5.144041450777202e-05,
    5.1269430051813476e-05,
    5.1098445595854924e-05,
    5.092746113989638e-05,
    5.0756476683937826e-05,
    5.058549222797928e-05,
    5.041450777202073e-05,
    5.0243523316062176e-05,
    5.007253886010363e-05,
    4.990155440414508e-05,
    4.973056994818653e-05,
    4.955958549222798e-05,
    4.9388601036269435e-05,
    4.921761658031088e-05,
    4.904663212435234e-05,
    4.8875647668393785e-05,
    4.870466321243523e-05,
    4.853367875647669e-05,
    4.8362694300518136e-05,
    4.819170984455959e-05,
    4.802072538860104e-05,
    4.784974093264249e-05,
    4.767875647668394e-05,
    4.7507772020725395e-05,
    4.733678756476684e-05,
    4.716580310880829e-05,
    4.6994818652849745e-05,
    4.682383419689119e-05,
    4.665284974093265e-05,
    4.6481865284974095e-05,
    4.631088082901555e-05,
    4.6139896373057e-05,
    4.5968911917098445e-05,
    4.57979274611399e-05,
    4.562694300518135e-05,
    4.54559585492228e-05,
    4.528497409326425e-05,
    4.5113989637305704e-05,
    4.494300518134715e-05,
    4.477202072538861e-05,
    4.4601036269430054e-05,
    4.44300518134715e-05,
    4.425906735751296e-05,
    4.4088082901554405e-05,
    4.391709844559586e-05,
    4.374611398963731e-05,
    4.357512953367876e-05,
    4.340414507772021e-05,
    4.3233160621761664e-05,
    4.306217616580311e-05,
    4.289119170984456e-05,
    4.2720207253886014e-05,
    4.254922279792746e-05,
    4.2378238341968916e-05,
    4.2207253886010364e-05,
    4.203626943005182e-05,
    4.1865284974093266e-05,
    4.169430051813472e-05,
    4.152331606217617e-05,
    4.1352331606217616e-05,
    4.118134715025907e-05,
    4.101036269430052e-05,
    4.083937823834197e-05,
    4.066839378238342e-05,
    4.0497409326424876e-05,
    4.0326424870466323e-05,
    4.015544041450777e-05,
    3.9984455958549226e-05,
    3.9813471502590674e-05,
    3.964248704663213e-05,
    3.9471502590673576e-05,
    3.930051813471503e-05,
    3.912953367875648e-05,
    3.8958549222797926e-05,
    3.878756476683938e-05,
    3.8616580310880835e-05,
    3.8445595854922276e-05,
    3.827461139896373e-05,
    3.8103626943005185e-05,
    3.793264248704664e-05,
    3.776165803108808e-05,
    3.7590673575129535e-05,
    3.741968911917099e-05,
    3.724870466321243e-05,
    3.7077720207253885e-05,
    3.690673575129534e-05,
    3.6735751295336795e-05,
    3.6564766839378236e-05,
    3.639378238341969e-05,
    3.6222797927461145e-05,
    3.60518134715026e-05,
    3.588082901554404e-05,
    3.5709844559585495e-05,
    3.553886010362695e-05,
    3.536787564766839e-05,
    3.5196891191709845e-05,
    3.50259067357513e-05,
    3.4854922279792754e-05,
    3.4683937823834195e-05,
    3.451295336787565e-05,
    3.4341968911917104e-05,
    3.4170984455958545e-05,
    3.4e-05,
    3.3829015544041454e-05,
    3.365803108808291e-05,
    3.348704663212435e-05,
    3.3316062176165804e-05,
    3.314507772020726e-05,
    3.2974093264248714e-05,
    3.2803108808290155e-05,
    3.263212435233161e-05,
    3.2461139896373064e-05,
    3.2290155440414505e-05,
    3.211917098445596e-05,
    3.1948186528497414e-05,
    3.177720207253887e-05,
    3.160621761658031e-05,
    3.1435233160621764e-05,
    3.126424870466322e-05,
    3.109326424870466e-05,
    3.0922279792746114e-05,
    3.075129533678757e-05,
    3.058031088082902e-05,
    3.0409326424870464e-05,
    3.023834196891192e-05,
    3.0067357512953373e-05,
    2.9896373056994814e-05,
    2.972538860103627e-05,
    2.9554404145077723e-05,
    2.9383419689119178e-05,
    2.921243523316062e-05,
    2.9041450777202073e-05,
    2.8870466321243528e-05,
    2.8699481865284983e-05,
    2.8528497409326424e-05,
    2.8357512953367878e-05,
    2.8186528497409333e-05,
    2.8015544041450774e-05,
    2.7844559585492228e-05,
    2.7673575129533683e-05,
    2.7502590673575137e-05,
    2.733160621761658e-05,
    2.7160621761658033e-05,
    2.6989637305699487e-05,
    2.681865284974093e-05,
    2.6647668393782383e-05,
    2.6476683937823838e-05,
    2.6305699481865292e-05,
    2.6134715025906733e-05,
    2.5963730569948188e-05,
    2.5792746113989642e-05,
    2.5621761658031097e-05,
    2.5450777202072538e-05,
    2.5279792746113992e-05,
    2.5108808290155447e-05,
    2.4937823834196888e-05,
    2.4766839378238342e-05,
    2.4595854922279797e-05,
    2.442487046632125e-05,
    2.4253886010362693e-05,
    2.4082901554404147e-05,
    2.3911917098445602e-05,
    2.3740932642487043e-05,
    2.3569948186528497e-05,
    2.3398963730569952e-05,
    2.3227979274611406e-05,
    2.3056994818652847e-05,
    2.2886010362694302e-05,
    2.2715025906735756e-05,
    2.2544041450777197e-05,
    2.2373056994818652e-05,
    2.2202072538860107e-05,
    2.203108808290156e-05,
    2.1860103626943002e-05,
    2.1689119170984457e-05,
    2.151813471502591e-05,
    2.1347150259067366e-05,
    2.1176165803108807e-05,
    2.100518134715026e-05,
    2.0834196891191716e-05,
    2.0663212435233157e-05,
    2.049222797927461e-05,
    2.0321243523316066e-05,
    2.015025906735752e-05,
    1.997927461139896e-05,
    1.9808290155440416e-05,
    1.963730569948187e-05,
    1.9466321243523312e-05,
    1.9295336787564766e-05,
    1.912435233160622e-05,
    1.8953367875647675e-05,
    1.8782383419689116e-05,
    1.861139896373057e-05,
    1.8440414507772026e-05,
    1.8269430051813467e-05,
    1.809844559585492e-05,
    1.7927461139896376e-05,
    1.775647668393783e-05,
    1.758549222797927e-05,
    1.7414507772020726e-05,
    1.724352331606218e-05,
    1.7072538860103635e-05,
    1.6901554404145076e-05,
    1.673056994818653e-05,
    1.6559585492227985e-05,
    1.6388601036269426e-05,
    1.621761658031088e-05,
    1.6046632124352335e-05,
    1.587564766839379e-05,
    1.570466321243523e-05,
    1.5533678756476685e-05,
    1.536269430051814e-05,
    1.519170984455958e-05,
    1.5020725388601035e-05,
    1.484974093264249e-05,
    1.4678756476683944e-05,
    1.4507772020725385e-05,
    1.433678756476684e-05,
    1.4165803108808295e-05,
    1.3994818652849749e-05,
    1.382383419689119e-05,
    1.3652849740932645e-05,
    1.34818652849741e-05,
    1.331088082901554e-05,
    1.3139896373056995e-05,
    1.296891191709845e-05,
    1.2797927461139904e-05,
    1.2626943005181345e-05,
    1.24559585492228e-05,
    1.2284974093264254e-05,
    1.2113989637305695e-05,
    1.194300518134715e-05,
    1.1772020725388604e-05,
    1.1601036269430059e-05,
    1.14300518134715e-05,
    1.1259067357512954e-05,
    1.1088082901554409e-05,
    1.091709844559585e-05,
    1.0746113989637304e-05,
    1.0575129533678759e-05,
    1.0404145077720213e-05,
    1.0233160621761654e-05,
    1.0062176165803109e-05,
    9.891191709844564e-06,
    9.720207253886018e-06,
    9.549222797927459e-06,
    9.378238341968914e-06,
    9.207253886010368e-06,
    9.03626943005181e-06,
    8.865284974093264e-06,
    8.694300518134718e-06,
    8.523316062176173e-06,
    8.352331606217614e-06,
    8.181347150259068e-06,
    8.010362694300523e-06,
    7.839378238341964e-06,
    7.668393782383419e-06,
    7.497409326424873e-06,
    7.326424870466328e-06,
    7.155440414507769e-06,
    6.984455958549223e-06,
    6.813471502590678e-06,
    6.642487046632132e-06,
    6.471502590673573e-06,
    6.300518134715028e-06,
    6.1295336787564825e-06,
    5.9585492227979235e-06,
    5.787564766839378e-06,
    5.616580310880833e-06,
    5.445595854922287e-06,
    5.274611398963728e-06,
    5.103626943005183e-06,
    4.932642487046637e-06,
    4.761658031088078e-06,
    4.590673575129533e-06,
    4.419689119170987e-06,
    4.248704663212442e-06,
    4.077720207253883e-06,
    3.9067357512953375e-06,
    3.735751295336792e-06,
    3.564766839378233e-06,
    3.3937823834196876e-06,
    3.222797927461142e-06,
    3.0518134715025967e-06,
    2.8808290155440377e-06,
    2.7098445595854923e-06,
    2.538860103626947e-06,
    2.3678756476684014e-06,
    2.1968911917098424e-06,
    2.025906735751297e-06,
    1.8549222797927515e-06,
    1.6839378238341925e-06,
    1.512953367875647e-06,
    1.3419689119171016e-06,
    1.1709844559585562e-06,
    1e-06,
]
load = "/u/zeineldeen/setups/librispeech/2022-11-28--conformer-att/work/i6_core/returnn/training/AverageTFCheckpointsJob.BxqgICRSGkgb/output/model/average"
log = ["./returnn.log"]
log_batch_size = True
log_verbosity = 5
max_seq_length = 0
max_seqs = 200
min_learning_rate = 1.6e-05
need_data = False
network = {
    "source": {
        "class": "eval",
        "eval": "self.network.get_config().typed_value('transform')(source(0, as_data=True), network=self.network)",
        "from": "log_mel_features",
    },
    "source0": {"class": "split_dims", "axis": "F", "dims": (-1, 1), "from": "source"},
    "conv0": {
        "class": "conv",
        "from": "source0",
        "padding": "same",
        "filter_size": (3, 3),
        "n_out": 32,
        "activation": "relu",
        "with_bias": True,
        "L2": 0.0001,
    },
    "conv0p": {
        "class": "pool",
        "from": "conv0",
        "pool_size": (1, 2),
        "mode": "max",
        "trainable": False,
        "padding": "same",
    },
    "conv_out": {"class": "copy", "from": "conv0p"},
    "subsample_conv0": {
        "class": "conv",
        "from": "conv_out",
        "padding": "same",
        "filter_size": (3, 3),
        "n_out": 64,
        "activation": "relu",
        "with_bias": True,
        "strides": (3, 1),
        "L2": 0.0001,
    },
    "subsample_conv1": {
        "class": "conv",
        "from": "subsample_conv0",
        "padding": "same",
        "filter_size": (3, 3),
        "n_out": 64,
        "activation": "relu",
        "with_bias": True,
        "strides": (2, 1),
        "L2": 0.0001,
    },
    "conv_merged": {"class": "merge_dims", "from": "subsample_conv1", "axes": "static"},
    "source_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conv_merged",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "source_dropout": {"class": "dropout", "from": "source_linear", "dropout": 0.1},
    "conformer_block_01_ffmod_1_ln": {"class": "layer_norm", "from": "source_dropout"},
    "conformer_block_01_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_01_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_01_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_01_ffmod_1_ff1",
    },
    "conformer_block_01_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_01_ffmod_1_relu",
    },
    "conformer_block_01_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_01_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_01_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_01_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_01_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_01_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_01_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_01_ffmod_1_drop2",
    },
    "conformer_block_01_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_01_ffmod_1_half_step", "source_dropout"],
        "n_out": 512,
    },
    "conformer_block_01_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_01_ffmod_1_res",
    },
    "conformer_block_01_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_01_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_01_self_att": {
        "class": "self_attention",
        "from": "conformer_block_01_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_01_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_01_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_01_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_01_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_01_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_01_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_01_self_att_dropout",
            "conformer_block_01_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_01_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_01_self_att_res",
    },
    "conformer_block_01_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_01_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_01_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_01_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_01_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_01_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_01_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_01_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_01_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_01_conv_mod_bn",
    },
    "conformer_block_01_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_01_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_01_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_01_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_01_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_01_conv_mod_drop", "conformer_block_01_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_01_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_01_conv_mod_res",
    },
    "conformer_block_01_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_01_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_01_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_01_ffmod_2_ff1",
    },
    "conformer_block_01_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_01_ffmod_2_relu",
    },
    "conformer_block_01_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_01_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_01_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_01_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_01_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_01_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_01_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_01_ffmod_2_drop2",
    },
    "conformer_block_01_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_01_ffmod_2_half_step",
            "conformer_block_01_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_01_ln": {
        "class": "layer_norm",
        "from": "conformer_block_01_ffmod_2_res",
    },
    "conformer_block_01": {"class": "copy", "from": "conformer_block_01_ln"},
    "conformer_block_02_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_01",
    },
    "conformer_block_02_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_02_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_02_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_02_ffmod_1_ff1",
    },
    "conformer_block_02_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_02_ffmod_1_relu",
    },
    "conformer_block_02_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_02_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_02_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_02_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_02_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_02_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_02_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_02_ffmod_1_drop2",
    },
    "conformer_block_02_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_02_ffmod_1_half_step", "conformer_block_01"],
        "n_out": 512,
    },
    "conformer_block_02_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_02_ffmod_1_res",
    },
    "conformer_block_02_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_02_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_02_self_att": {
        "class": "self_attention",
        "from": "conformer_block_02_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_02_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_02_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_02_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_02_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_02_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_02_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_02_self_att_dropout",
            "conformer_block_02_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_02_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_02_self_att_res",
    },
    "conformer_block_02_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_02_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_02_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_02_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_02_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_02_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_02_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_02_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_02_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_02_conv_mod_bn",
    },
    "conformer_block_02_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_02_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_02_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_02_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_02_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_02_conv_mod_drop", "conformer_block_02_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_02_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_02_conv_mod_res",
    },
    "conformer_block_02_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_02_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_02_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_02_ffmod_2_ff1",
    },
    "conformer_block_02_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_02_ffmod_2_relu",
    },
    "conformer_block_02_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_02_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_02_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_02_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_02_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_02_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_02_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_02_ffmod_2_drop2",
    },
    "conformer_block_02_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_02_ffmod_2_half_step",
            "conformer_block_02_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_02_ln": {
        "class": "layer_norm",
        "from": "conformer_block_02_ffmod_2_res",
    },
    "conformer_block_02": {"class": "copy", "from": "conformer_block_02_ln"},
    "conformer_block_03_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_02",
    },
    "conformer_block_03_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_03_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_03_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_03_ffmod_1_ff1",
    },
    "conformer_block_03_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_03_ffmod_1_relu",
    },
    "conformer_block_03_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_03_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_03_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_03_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_03_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_03_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_03_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_03_ffmod_1_drop2",
    },
    "conformer_block_03_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_03_ffmod_1_half_step", "conformer_block_02"],
        "n_out": 512,
    },
    "conformer_block_03_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_03_ffmod_1_res",
    },
    "conformer_block_03_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_03_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_03_self_att": {
        "class": "self_attention",
        "from": "conformer_block_03_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_03_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_03_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_03_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_03_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_03_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_03_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_03_self_att_dropout",
            "conformer_block_03_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_03_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_03_self_att_res",
    },
    "conformer_block_03_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_03_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_03_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_03_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_03_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_03_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_03_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_03_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_03_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_03_conv_mod_bn",
    },
    "conformer_block_03_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_03_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_03_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_03_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_03_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_03_conv_mod_drop", "conformer_block_03_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_03_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_03_conv_mod_res",
    },
    "conformer_block_03_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_03_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_03_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_03_ffmod_2_ff1",
    },
    "conformer_block_03_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_03_ffmod_2_relu",
    },
    "conformer_block_03_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_03_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_03_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_03_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_03_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_03_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_03_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_03_ffmod_2_drop2",
    },
    "conformer_block_03_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_03_ffmod_2_half_step",
            "conformer_block_03_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_03_ln": {
        "class": "layer_norm",
        "from": "conformer_block_03_ffmod_2_res",
    },
    "conformer_block_03": {"class": "copy", "from": "conformer_block_03_ln"},
    "conformer_block_04_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_03",
    },
    "conformer_block_04_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_04_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_04_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_04_ffmod_1_ff1",
    },
    "conformer_block_04_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_04_ffmod_1_relu",
    },
    "conformer_block_04_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_04_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_04_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_04_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_04_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_04_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_04_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_04_ffmod_1_drop2",
    },
    "conformer_block_04_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_04_ffmod_1_half_step", "conformer_block_03"],
        "n_out": 512,
    },
    "conformer_block_04_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_04_ffmod_1_res",
    },
    "conformer_block_04_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_04_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_04_self_att": {
        "class": "self_attention",
        "from": "conformer_block_04_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_04_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_04_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_04_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_04_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_04_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_04_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_04_self_att_dropout",
            "conformer_block_04_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_04_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_04_self_att_res",
    },
    "conformer_block_04_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_04_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_04_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_04_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_04_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_04_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_04_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_04_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_04_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_04_conv_mod_bn",
    },
    "conformer_block_04_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_04_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_04_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_04_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_04_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_04_conv_mod_drop", "conformer_block_04_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_04_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_04_conv_mod_res",
    },
    "conformer_block_04_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_04_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_04_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_04_ffmod_2_ff1",
    },
    "conformer_block_04_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_04_ffmod_2_relu",
    },
    "conformer_block_04_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_04_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_04_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_04_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_04_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_04_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_04_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_04_ffmod_2_drop2",
    },
    "conformer_block_04_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_04_ffmod_2_half_step",
            "conformer_block_04_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_04_ln": {
        "class": "layer_norm",
        "from": "conformer_block_04_ffmod_2_res",
    },
    "conformer_block_04": {"class": "copy", "from": "conformer_block_04_ln"},
    "conformer_block_05_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_04",
    },
    "conformer_block_05_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_05_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_05_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_05_ffmod_1_ff1",
    },
    "conformer_block_05_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_05_ffmod_1_relu",
    },
    "conformer_block_05_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_05_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_05_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_05_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_05_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_05_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_05_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_05_ffmod_1_drop2",
    },
    "conformer_block_05_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_05_ffmod_1_half_step", "conformer_block_04"],
        "n_out": 512,
    },
    "conformer_block_05_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_05_ffmod_1_res",
    },
    "conformer_block_05_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_05_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_05_self_att": {
        "class": "self_attention",
        "from": "conformer_block_05_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_05_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_05_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_05_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_05_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_05_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_05_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_05_self_att_dropout",
            "conformer_block_05_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_05_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_05_self_att_res",
    },
    "conformer_block_05_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_05_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_05_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_05_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_05_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_05_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_05_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_05_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_05_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_05_conv_mod_bn",
    },
    "conformer_block_05_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_05_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_05_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_05_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_05_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_05_conv_mod_drop", "conformer_block_05_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_05_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_05_conv_mod_res",
    },
    "conformer_block_05_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_05_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_05_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_05_ffmod_2_ff1",
    },
    "conformer_block_05_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_05_ffmod_2_relu",
    },
    "conformer_block_05_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_05_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_05_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_05_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_05_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_05_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_05_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_05_ffmod_2_drop2",
    },
    "conformer_block_05_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_05_ffmod_2_half_step",
            "conformer_block_05_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_05_ln": {
        "class": "layer_norm",
        "from": "conformer_block_05_ffmod_2_res",
    },
    "conformer_block_05": {"class": "copy", "from": "conformer_block_05_ln"},
    "conformer_block_06_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_05",
    },
    "conformer_block_06_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_06_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_06_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_06_ffmod_1_ff1",
    },
    "conformer_block_06_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_06_ffmod_1_relu",
    },
    "conformer_block_06_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_06_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_06_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_06_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_06_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_06_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_06_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_06_ffmod_1_drop2",
    },
    "conformer_block_06_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_06_ffmod_1_half_step", "conformer_block_05"],
        "n_out": 512,
    },
    "conformer_block_06_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_06_ffmod_1_res",
    },
    "conformer_block_06_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_06_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_06_self_att": {
        "class": "self_attention",
        "from": "conformer_block_06_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_06_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_06_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_06_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_06_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_06_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_06_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_06_self_att_dropout",
            "conformer_block_06_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_06_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_06_self_att_res",
    },
    "conformer_block_06_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_06_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_06_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_06_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_06_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_06_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_06_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_06_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_06_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_06_conv_mod_bn",
    },
    "conformer_block_06_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_06_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_06_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_06_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_06_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_06_conv_mod_drop", "conformer_block_06_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_06_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_06_conv_mod_res",
    },
    "conformer_block_06_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_06_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_06_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_06_ffmod_2_ff1",
    },
    "conformer_block_06_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_06_ffmod_2_relu",
    },
    "conformer_block_06_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_06_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_06_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_06_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_06_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_06_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_06_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_06_ffmod_2_drop2",
    },
    "conformer_block_06_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_06_ffmod_2_half_step",
            "conformer_block_06_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_06_ln": {
        "class": "layer_norm",
        "from": "conformer_block_06_ffmod_2_res",
    },
    "conformer_block_06": {"class": "copy", "from": "conformer_block_06_ln"},
    "conformer_block_07_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_06",
    },
    "conformer_block_07_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_07_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_07_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_07_ffmod_1_ff1",
    },
    "conformer_block_07_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_07_ffmod_1_relu",
    },
    "conformer_block_07_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_07_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_07_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_07_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_07_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_07_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_07_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_07_ffmod_1_drop2",
    },
    "conformer_block_07_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_07_ffmod_1_half_step", "conformer_block_06"],
        "n_out": 512,
    },
    "conformer_block_07_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_07_ffmod_1_res",
    },
    "conformer_block_07_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_07_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_07_self_att": {
        "class": "self_attention",
        "from": "conformer_block_07_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_07_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_07_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_07_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_07_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_07_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_07_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_07_self_att_dropout",
            "conformer_block_07_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_07_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_07_self_att_res",
    },
    "conformer_block_07_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_07_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_07_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_07_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_07_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_07_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_07_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_07_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_07_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_07_conv_mod_bn",
    },
    "conformer_block_07_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_07_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_07_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_07_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_07_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_07_conv_mod_drop", "conformer_block_07_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_07_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_07_conv_mod_res",
    },
    "conformer_block_07_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_07_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_07_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_07_ffmod_2_ff1",
    },
    "conformer_block_07_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_07_ffmod_2_relu",
    },
    "conformer_block_07_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_07_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_07_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_07_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_07_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_07_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_07_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_07_ffmod_2_drop2",
    },
    "conformer_block_07_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_07_ffmod_2_half_step",
            "conformer_block_07_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_07_ln": {
        "class": "layer_norm",
        "from": "conformer_block_07_ffmod_2_res",
    },
    "conformer_block_07": {"class": "copy", "from": "conformer_block_07_ln"},
    "conformer_block_08_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_07",
    },
    "conformer_block_08_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_08_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_08_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_08_ffmod_1_ff1",
    },
    "conformer_block_08_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_08_ffmod_1_relu",
    },
    "conformer_block_08_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_08_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_08_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_08_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_08_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_08_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_08_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_08_ffmod_1_drop2",
    },
    "conformer_block_08_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_08_ffmod_1_half_step", "conformer_block_07"],
        "n_out": 512,
    },
    "conformer_block_08_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_08_ffmod_1_res",
    },
    "conformer_block_08_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_08_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_08_self_att": {
        "class": "self_attention",
        "from": "conformer_block_08_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_08_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_08_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_08_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_08_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_08_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_08_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_08_self_att_dropout",
            "conformer_block_08_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_08_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_08_self_att_res",
    },
    "conformer_block_08_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_08_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_08_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_08_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_08_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_08_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_08_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_08_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_08_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_08_conv_mod_bn",
    },
    "conformer_block_08_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_08_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_08_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_08_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_08_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_08_conv_mod_drop", "conformer_block_08_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_08_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_08_conv_mod_res",
    },
    "conformer_block_08_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_08_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_08_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_08_ffmod_2_ff1",
    },
    "conformer_block_08_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_08_ffmod_2_relu",
    },
    "conformer_block_08_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_08_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_08_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_08_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_08_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_08_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_08_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_08_ffmod_2_drop2",
    },
    "conformer_block_08_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_08_ffmod_2_half_step",
            "conformer_block_08_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_08_ln": {
        "class": "layer_norm",
        "from": "conformer_block_08_ffmod_2_res",
    },
    "conformer_block_08": {"class": "copy", "from": "conformer_block_08_ln"},
    "conformer_block_09_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_08",
    },
    "conformer_block_09_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_09_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_09_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_09_ffmod_1_ff1",
    },
    "conformer_block_09_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_09_ffmod_1_relu",
    },
    "conformer_block_09_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_09_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_09_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_09_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_09_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_09_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_09_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_09_ffmod_1_drop2",
    },
    "conformer_block_09_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_09_ffmod_1_half_step", "conformer_block_08"],
        "n_out": 512,
    },
    "conformer_block_09_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_09_ffmod_1_res",
    },
    "conformer_block_09_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_09_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_09_self_att": {
        "class": "self_attention",
        "from": "conformer_block_09_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_09_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_09_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_09_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_09_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_09_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_09_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_09_self_att_dropout",
            "conformer_block_09_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_09_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_09_self_att_res",
    },
    "conformer_block_09_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_09_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_09_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_09_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_09_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_09_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_09_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_09_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_09_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_09_conv_mod_bn",
    },
    "conformer_block_09_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_09_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_09_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_09_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_09_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_09_conv_mod_drop", "conformer_block_09_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_09_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_09_conv_mod_res",
    },
    "conformer_block_09_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_09_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_09_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_09_ffmod_2_ff1",
    },
    "conformer_block_09_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_09_ffmod_2_relu",
    },
    "conformer_block_09_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_09_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_09_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_09_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_09_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_09_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_09_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_09_ffmod_2_drop2",
    },
    "conformer_block_09_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_09_ffmod_2_half_step",
            "conformer_block_09_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_09_ln": {
        "class": "layer_norm",
        "from": "conformer_block_09_ffmod_2_res",
    },
    "conformer_block_09": {"class": "copy", "from": "conformer_block_09_ln"},
    "conformer_block_10_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_09",
    },
    "conformer_block_10_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_10_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_10_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_10_ffmod_1_ff1",
    },
    "conformer_block_10_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_10_ffmod_1_relu",
    },
    "conformer_block_10_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_10_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_10_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_10_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_10_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_10_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_10_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_10_ffmod_1_drop2",
    },
    "conformer_block_10_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_10_ffmod_1_half_step", "conformer_block_09"],
        "n_out": 512,
    },
    "conformer_block_10_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_10_ffmod_1_res",
    },
    "conformer_block_10_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_10_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_10_self_att": {
        "class": "self_attention",
        "from": "conformer_block_10_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_10_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_10_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_10_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_10_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_10_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_10_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_10_self_att_dropout",
            "conformer_block_10_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_10_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_10_self_att_res",
    },
    "conformer_block_10_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_10_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_10_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_10_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_10_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_10_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_10_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_10_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_10_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_10_conv_mod_bn",
    },
    "conformer_block_10_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_10_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_10_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_10_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_10_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_10_conv_mod_drop", "conformer_block_10_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_10_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_10_conv_mod_res",
    },
    "conformer_block_10_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_10_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_10_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_10_ffmod_2_ff1",
    },
    "conformer_block_10_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_10_ffmod_2_relu",
    },
    "conformer_block_10_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_10_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_10_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_10_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_10_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_10_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_10_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_10_ffmod_2_drop2",
    },
    "conformer_block_10_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_10_ffmod_2_half_step",
            "conformer_block_10_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_10_ln": {
        "class": "layer_norm",
        "from": "conformer_block_10_ffmod_2_res",
    },
    "conformer_block_10": {"class": "copy", "from": "conformer_block_10_ln"},
    "conformer_block_11_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_10",
    },
    "conformer_block_11_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_11_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_11_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_11_ffmod_1_ff1",
    },
    "conformer_block_11_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_11_ffmod_1_relu",
    },
    "conformer_block_11_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_11_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_11_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_11_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_11_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_11_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_11_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_11_ffmod_1_drop2",
    },
    "conformer_block_11_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_11_ffmod_1_half_step", "conformer_block_10"],
        "n_out": 512,
    },
    "conformer_block_11_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_11_ffmod_1_res",
    },
    "conformer_block_11_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_11_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_11_self_att": {
        "class": "self_attention",
        "from": "conformer_block_11_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_11_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_11_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_11_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_11_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_11_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_11_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_11_self_att_dropout",
            "conformer_block_11_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_11_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_11_self_att_res",
    },
    "conformer_block_11_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_11_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_11_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_11_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_11_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_11_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_11_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_11_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_11_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_11_conv_mod_bn",
    },
    "conformer_block_11_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_11_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_11_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_11_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_11_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_11_conv_mod_drop", "conformer_block_11_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_11_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_11_conv_mod_res",
    },
    "conformer_block_11_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_11_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_11_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_11_ffmod_2_ff1",
    },
    "conformer_block_11_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_11_ffmod_2_relu",
    },
    "conformer_block_11_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_11_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_11_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_11_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_11_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_11_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_11_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_11_ffmod_2_drop2",
    },
    "conformer_block_11_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_11_ffmod_2_half_step",
            "conformer_block_11_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_11_ln": {
        "class": "layer_norm",
        "from": "conformer_block_11_ffmod_2_res",
    },
    "conformer_block_11": {"class": "copy", "from": "conformer_block_11_ln"},
    "conformer_block_12_ffmod_1_ln": {
        "class": "layer_norm",
        "from": "conformer_block_11",
    },
    "conformer_block_12_ffmod_1_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_12_ffmod_1_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_12_ffmod_1_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_12_ffmod_1_ff1",
    },
    "conformer_block_12_ffmod_1_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_12_ffmod_1_relu",
    },
    "conformer_block_12_ffmod_1_drop1": {
        "class": "dropout",
        "from": "conformer_block_12_ffmod_1_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_12_ffmod_1_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_12_ffmod_1_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_12_ffmod_1_drop2": {
        "class": "dropout",
        "from": "conformer_block_12_ffmod_1_ff2",
        "dropout": 0.1,
    },
    "conformer_block_12_ffmod_1_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_12_ffmod_1_drop2",
    },
    "conformer_block_12_ffmod_1_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_12_ffmod_1_half_step", "conformer_block_11"],
        "n_out": 512,
    },
    "conformer_block_12_self_att_ln": {
        "class": "layer_norm",
        "from": "conformer_block_12_ffmod_1_res",
    },
    "conformer_block_12_self_att_ln_rel_pos_enc": {
        "class": "relative_positional_encoding",
        "from": "conformer_block_12_self_att_ln",
        "n_out": 64,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "clipping": 16,
    },
    "conformer_block_12_self_att": {
        "class": "self_attention",
        "from": "conformer_block_12_self_att_ln",
        "n_out": 512,
        "num_heads": 8,
        "total_key_dim": 512,
        "attention_dropout": 0.1,
        "key_shift": "conformer_block_12_self_att_ln_rel_pos_enc",
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=0.5)",
    },
    "conformer_block_12_self_att_linear": {
        "class": "linear",
        "activation": None,
        "with_bias": False,
        "from": "conformer_block_12_self_att",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_12_self_att_dropout": {
        "class": "dropout",
        "from": "conformer_block_12_self_att_linear",
        "dropout": 0.1,
    },
    "conformer_block_12_self_att_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_12_self_att_dropout",
            "conformer_block_12_ffmod_1_res",
        ],
        "n_out": 512,
    },
    "conformer_block_12_conv_mod_ln": {
        "class": "layer_norm",
        "from": "conformer_block_12_self_att_res",
    },
    "conformer_block_12_conv_mod_pointwise_conv1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_12_conv_mod_ln",
        "n_out": 1024,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_12_conv_mod_glu": {
        "class": "gating",
        "from": "conformer_block_12_conv_mod_pointwise_conv1",
        "activation": "identity",
    },
    "conformer_block_12_conv_mod_depthwise_conv2": {
        "class": "conv",
        "from": "conformer_block_12_conv_mod_glu",
        "padding": "same",
        "filter_size": (32,),
        "n_out": 512,
        "activation": None,
        "with_bias": True,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
        "groups": 512,
    },
    "conformer_block_12_conv_mod_bn": {
        "class": "batch_norm",
        "from": "conformer_block_12_conv_mod_depthwise_conv2",
        "momentum": 0.1,
        "epsilon": 0.001,
        "update_sample_only_in_training": True,
        "delay_sample_update": True,
    },
    "conformer_block_12_conv_mod_swish": {
        "class": "activation",
        "activation": "swish",
        "from": "conformer_block_12_conv_mod_bn",
    },
    "conformer_block_12_conv_mod_pointwise_conv2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_12_conv_mod_swish",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', "
        "scale=1.0)",
    },
    "conformer_block_12_conv_mod_drop": {
        "class": "dropout",
        "from": "conformer_block_12_conv_mod_pointwise_conv2",
        "dropout": 0.1,
    },
    "conformer_block_12_conv_mod_res": {
        "class": "combine",
        "kind": "add",
        "from": ["conformer_block_12_conv_mod_drop", "conformer_block_12_self_att_res"],
        "n_out": 512,
    },
    "conformer_block_12_ffmod_2_ln": {
        "class": "layer_norm",
        "from": "conformer_block_12_conv_mod_res",
    },
    "conformer_block_12_ffmod_2_ff1": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_12_ffmod_2_ln",
        "n_out": 2048,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_12_ffmod_2_relu": {
        "class": "activation",
        "activation": "relu",
        "from": "conformer_block_12_ffmod_2_ff1",
    },
    "conformer_block_12_ffmod_2_square_relu": {
        "class": "eval",
        "eval": "source(0) ** 2",
        "from": "conformer_block_12_ffmod_2_relu",
    },
    "conformer_block_12_ffmod_2_drop1": {
        "class": "dropout",
        "from": "conformer_block_12_ffmod_2_square_relu",
        "dropout": 0.1,
    },
    "conformer_block_12_ffmod_2_ff2": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "conformer_block_12_ffmod_2_drop1",
        "n_out": 512,
        "L2": 0.0001,
        "forward_weights_init": "variance_scaling_initializer(mode='fan_avg', distribution='uniform', scale=1.0)",
    },
    "conformer_block_12_ffmod_2_drop2": {
        "class": "dropout",
        "from": "conformer_block_12_ffmod_2_ff2",
        "dropout": 0.1,
    },
    "conformer_block_12_ffmod_2_half_step": {
        "class": "eval",
        "eval": "0.5 * source(0)",
        "from": "conformer_block_12_ffmod_2_drop2",
    },
    "conformer_block_12_ffmod_2_res": {
        "class": "combine",
        "kind": "add",
        "from": [
            "conformer_block_12_ffmod_2_half_step",
            "conformer_block_12_conv_mod_res",
        ],
        "n_out": 512,
    },
    "conformer_block_12_ln": {
        "class": "layer_norm",
        "from": "conformer_block_12_ffmod_2_res",
    },
    "conformer_block_12": {"class": "copy", "from": "conformer_block_12_ln"},
    "encoder": {"class": "copy", "from": "conformer_block_12"},
    "ctc": {
        "class": "softmax",
        "from": "encoder",
        "target": "bpe_labels",
        "loss": "ctc",
        "loss_opts": {"beam_width": 1, "use_native": True},
        "loss_scale": 1.0,
    },
    "enc_ctx": {
        "class": "linear",
        "activation": None,
        "with_bias": True,
        "from": "encoder",
        "n_out": 1024,
        "L2": 0.0001,
    },
    "enc_value": {
        "class": "split_dims",
        "axis": "F",
        "dims": (1, 512),
        "from": "encoder",
    },
    "inv_fertility": {
        "class": "linear",
        "activation": "sigmoid",
        "with_bias": False,
        "from": "encoder",
        "n_out": 1,
    },
    "decision": {
        "class": "decide",
        "from": "output",
        "loss": "edit_distance",
        "target": "bpe_labels",
    },
    "output": {
        "class": "rec",
        "from": [],
        "unit": {
            "end": {"class": "compare", "kind": "equal", "from": "output", "value": 0},
            "target_embed0": {
                "class": "linear",
                "activation": None,
                "with_bias": False,
                "from": "output",
                "n_out": 640,
                "L2": 0.0001,
                "initial_output": 0,
            },
            "target_embed": {
                "class": "dropout",
                "from": "target_embed0",
                "dropout": 0.1,
                "dropout_noise_shape": {"*": None},
            },
            "s_transformed": {
                "class": "linear",
                "activation": None,
                "with_bias": False,
                "from": "s",
                "n_out": 1024,
                "L2": 0.0001,
            },
            "accum_att_weights": {
                "class": "eval",
                "eval": "source(0) + source(1) * source(2) * 0.5",
                "from": ["prev:accum_att_weights", "att_weights", "base:inv_fertility"],
                "out_type": {"dim": 1, "shape": (None, 1)},
            },
            "weight_feedback": {
                "class": "linear",
                "activation": None,
                "with_bias": False,
                "from": "prev:accum_att_weights",
                "n_out": 1024,
            },
            "energy_in": {
                "class": "combine",
                "kind": "add",
                "from": ["base:enc_ctx", "weight_feedback", "s_transformed"],
                "n_out": 1024,
            },
            "energy_tanh": {
                "class": "activation",
                "activation": "tanh",
                "from": "energy_in",
            },
            "energy": {
                "class": "linear",
                "activation": None,
                "with_bias": False,
                "from": "energy_tanh",
                "n_out": 1,
                "L2": 0.0001,
            },
            "att_weights": {"class": "softmax_over_spatial", "from": "energy"},
            "att0": {
                "class": "generic_attention",
                "weights": "att_weights",
                "base": "base:enc_value",
            },
            "att": {"class": "merge_dims", "from": "att0", "axes": "except_batch"},
            "s": {
                "class": "rnn_cell",
                "unit": "zoneoutlstm",
                "n_out": 1024,
                "from": ["prev:target_embed", "prev:att"],
                "L2": 0.0001,
                "unit_opts": {
                    "zoneout_factor_cell": 0.15,
                    "zoneout_factor_output": 0.05,
                },
            },
            "readout_in": {
                "class": "linear",
                "activation": None,
                "with_bias": True,
                "from": ["s", "prev:target_embed", "att"],
                "n_out": 1024,
                "L2": 0.0001,
            },
            "readout": {
                "class": "reduce_out",
                "from": "readout_in",
                "num_pieces": 2,
                "mode": "max",
            },
            "output_prob": {
                "class": "softmax",
                "from": "readout",
                "dropout": 0.3,
                "target": "bpe_labels",
                "loss": "ce",
                "loss_opts": {"label_smoothing": 0.1},
                "L2": 0.0001,
            },
            "output": {
                "class": "choice",
                "target": "bpe_labels",
                "beam_size": 12,
                "from": "output_prob",
                "initial_output": 0,
            },
        },
        "target": "bpe_labels",
        "max_seq_len": "max_len_from('base:encoder')",
    },
    "stft": {
        "class": "stft",
        "frame_shift": 160,
        "frame_size": 400,
        "fft_size": 512,
        "from": "data:audio_features",
    },
    "abs": {"class": "activation", "from": "stft", "activation": "abs"},
    "power": {"class": "eval", "from": "abs", "eval": "source(0) ** 2"},
    "mel_filterbank": {
        "class": "mel_filterbank",
        "from": "power",
        "fft_size": 512,
        "nr_of_filters": 80,
        "n_out": 80,
    },
    "log": {
        "from": "mel_filterbank",
        "class": "activation",
        "activation": "safe_log",
        "opts": {"eps": 1e-10},
    },
    "log10": {"from": "log", "class": "eval", "eval": "source(0) / 2.3026"},
    "log_mel_features": {"class": "copy", "from": "log10"},
}
newbob_learning_rate_decay = 0.95
newbob_multi_num_epochs = 20
newbob_multi_update_interval = 1
optimizer_epsilon = 1e-08
search_data = {
    "class": "MetaDataset",
    "data_map": {
        "audio_features": ("zip_dataset", "data"),
        "bpe_labels": ("zip_dataset", "classes"),
    },
    "datasets": {
        "zip_dataset": {
            "class": "OggZipDataset",
            "path": "/u/zeineldeen/setups/librispeech/2022-11-28--conformer-att/work/i6_core/returnn/oggzip/BlissToOggZipJob.NSdIHfk1iw2M/output/out.ogg.zip",
            "use_cache_manager": True,
            "audio": {
                "features": "raw",
                "peak_normalization": True,
                "preemphasis": None,
            },
            "targets": {
                "class": "BytePairEncoding",
                "bpe_file": "/u/zeineldeen/setups/librispeech/2022-11-28--conformer-att/work/i6_core/text/label/subword_nmt/train/ReturnnTrainBpeJob.vTq56NZ8STWt/output/bpe.codes",
                "vocab_file": "/u/zeineldeen/setups/librispeech/2022-11-28--conformer-att/work/i6_core/text/label/subword_nmt/train/ReturnnTrainBpeJob.vTq56NZ8STWt/output/bpe.vocab",
                "unknown_label": "<unk>",
                "seq_postfix": [0],
            },
            "segment_file": None,
            "partition_epoch": 1,
            "seq_ordering": "sorted_reverse",
        }
    },
    "seq_order_control_dataset": "zip_dataset",
}
search_do_eval = 0
search_output_file = "/u/zeineldeen/setups/librispeech/2022-11-28--conformer-att/work/i6_core/returnn/search/ReturnnSearchJobV2.1oORPHJTAcW0/output/search_out"
search_output_file_format = "py"
search_output_layer = "decision"
task = "search"
tf_log_memory_usage = True
truncation = -1
use_learning_rate_control_always = True
use_tensorflow = True
config = {}

locals().update(**config)

import sys

sys.setrecursionlimit(3000)
